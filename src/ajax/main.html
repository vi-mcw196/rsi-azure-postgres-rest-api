<!DOCTYPE html>
<html>
<head>
    <title>Person Management</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
        }

        #person-form {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        #person-form input {
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            flex: 0 0 calc(100% / 3 - 20px);
        }

        #person-form button {
            padding: 10px 20px;
            margin: 10px 5px;
            border-radius: 5px;
            border: none;
            background-color: #007BFF;
            color: white;
            cursor: pointer;
        }

        #person-form button:hover {
            background-color: #0056b3;
        }

        #persons-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #persons-table th, #persons-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #persons-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #persons-table th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #4CAF50;
            color: white;
        }

        #error {
            color: red;
            margin-top: 20px;
        }
    </style>

</head>
<body>
<h1>Person Management</h1>

<form id="person-form">
    <input type="text" id="id" name="id" placeholder="ID">
    <input type="text" id="name" name="firstName" placeholder="Name">
    <input type="number" id="age" name="age" placeholder="Age">
    <input type="email" id="email" name="email" placeholder="Email">
    <input type="text" id="status" name="status" placeholder="Status">

    <button id="getAllPersons">Get All Persons</button>
    <button id="getPerson">Get Person</button>
    <button id="deletePerson">Delete Person</button>
    <button id="addPerson">Add Person</button>
    <button id="updatePerson">Update Person</button>
    <button id="hirePerson">Hire Person</button>
    <button id="vacatePerson">Vacate Person</button>
    <button id="countPersons">Count Persons</button>
    <button id="reload">Reload</button>
</form>

<label>Data Format:</label>
<input type="radio" id="json-format" name="data-format" value="json" checked>
<label for="json-format">JSON</label>
<input type="radio" id="xml-format" name="data-format" value="xml">
<label for="xml-format">XML</label>

<table id="persons-table">
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Age</th>
        <th>Email</th>
        <th>Status</th>
    </tr>
    <!-- Rows will be dynamically inserted here -->
</table>

<div id="error"></div>


<script>
    $(document).ready(function() {
        let port = 8081;
        let dataType = 'json';
        let contentType = 'application/json';

        $('input[type=radio][name=data-format]').change(function() {
            if (this.value === 'json') {
                port = 8081;
                dataType = 'json';
                contentType = 'application/json';
            } else if (this.value === 'xml') {
                port = 8080;
                dataType = 'xml';
                contentType = 'application/xml';
            }
            loadPersons(); // Update the persons list when the data format is changed
        });

        function loadPersons() {
            $.ajax({
                url: `http://localhost:${port}/persons/`,
                method: 'GET',
                dataType: dataType,
                success: function(data) {
                    $('#persons-table').empty();
                    $('#persons-table').append('<tr><th>ID</th><th>Name</th><th>Age</th><th>Email</th><th>Status</th></tr>');
                    if(dataType === 'json'){
                        $.each(data, function(index, person) {
                            $('#persons-table').append(`<tr><td>${person.id}</td><td>${person.firstName}</td><td>${person.age}</td><td>${person.email}</td><td>${person.status}</td></tr>`);
                        });
                    } else {
                        $(data).find('item').each(function(){
                            const person = $(this);
                            $('#persons-table').append('<tr><td>'
                                + person.find('id').text() + '</td><td>'
                                + person.find('firstName').text() + '</td><td>'
                                + person.find('age').text() + '</td><td>'
                                + person.find('email').text() + '</td><td>'
                                + person.find('status').text() + '</td></tr>');
                        });
                    }
                    $('#error').empty();
                },
                error: function(err) {
                    $('#error').text(`Error: ${err.statusText}`);
                }
            });
        }

        // Get All Persons (with optional name filter)
        $('#getAllPersons').click(function(e) {
            e.preventDefault();
            let url = `http://localhost:${port}/persons/`;
            const name = $('#name').val();
            if (name !== '') {
                url += `?name=${name}`;
            }
            $.ajax({
                url: url,
                method: 'GET',
                dataType: dataType,
                success: function(data) {
                    $('#persons-table').empty();
                    $('#persons-table').show();
                    $('#persons-table').append('<tr><th>ID</th><th>Name</th><th>Age</th><th>Email</th><th>Status</th></tr>');
                    if(dataType === 'json'){
                        $.each(data, function(index, person) {
                            $('#persons-table').append(`<tr><td>${person.id}</td><td>${person.firstName}</td><td>${person.age}</td><td>${person.email}</td><td>${person.status}</td></tr>`);
                        });
                    } else {
                        $(data).find('item').each(function(){
                            const person = $(this);
                            $('#persons-table').append('<tr><td>'
                                + person.find('id').text() + '</td><td>'
                                + person.find('firstName').text() + '</td><td>'
                                + person.find('age').text() + '</td><td>'
                                + person.find('email').text() + '</td><td>'
                                + person.find('status').text() + '</td></tr>');
                        });
                    }
                    $('#error').empty();
                },
                error: function(err) {
                    $('#persons-table').hide();
                    $('#error').text(`Error: ${err.statusText}`);
                }
            });
        });

        // Get Person
        $('#getPerson').click(function(e) {
            e.preventDefault();
            $.ajax({
                url: `http://localhost:${port}/persons/${$('#id').val()}`,
                method: 'GET',
                dataType: dataType,
                success: function(person) {
                    $('#persons-table').empty();
                    $('#persons-table').append('<tr><th>ID</th><th>Name</th><th>Age</th><th>Email</th><th>Status</th></tr>');
                    $('#persons-table').append(`<tr><td>${person.id}</td><td>${person.firstName}</td><td>${person.age}</td><td>${person.email}</td><td>${person.status}</td></tr>`);
                    $('#error').empty();
                },
                error: function(err) {
                    $('#persons-table').hide();
                    $('#error').text(`Error: ${err.statusText}`);
                }
            });
        });


        // Delete Person
        $('#deletePerson').click(function(e) {
            e.preventDefault();
            $.ajax({
                url: `http://localhost:${port}/persons/${$('#id').val()}`,
                method: 'DELETE',
                success: function() {
                    $('#error').empty();
                    loadPersons();
                },
                error: function(err) {
                    $('#persons-table').hide();
                    $('#error').text(`Error: ${err.statusText}`);
                }
            });
        });

        // Add Person
        $('#addPerson').click(function(e) {
            e.preventDefault();
            let person = {
                firstName: $('#name').val(),
                age: $('#age').val(),
                email: $('#email').val(),
                status: $('#status').val()
            };
            if(dataType === 'xml'){
                person = `<item>
                <firstName>${person.firstName}</firstName>
                <age>${person.age}</age>
                <email>${person.email}</email>
                <status>${person.status}</status>
            </item>`;
            }else{
                person = JSON.stringify(person);
            }
            $.ajax({
                url: `http://localhost:${port}/persons/`,
                method: 'POST',
                contentType: contentType,
                data: person,
                success: function() {
                    $('#error').empty();
                    loadPersons();
                },
                error: function(err) {
                    $('#persons-table').hide();
                    $('#error').text(`Error: ${err.statusText}`);
                }
            });
        });

        // Update Person
        $('#updatePerson').click(function(e) {
            e.preventDefault();
            let person;
            if(dataType === 'json'){
                person = {
                    id: $('#id').val(),
                    firstName: $('#name').val(),
                    age: $('#age').val(),
                    email: $('#email').val(),
                    status: $('#status').val()
                };
                person = JSON.stringify(person);
            } else {
                person = `<item>
                <id>${$('#id').val()}</id>
                <firstName>${$('#name').val()}</firstName>
                <age>${$('#age').val()}</age>
                <email>${$('#email').val()}</email>
                <status>${$('#status').val()}</status>
            </item>`;
            }
            $.ajax({
                url: `http://localhost:${port}/persons/${$('#id').val()}`,
                method: 'PUT',
                contentType: contentType,
                data: person,
                success: function() {
                    $('#error').empty();
                    loadPersons();
                },
                error: function(err) {
                    $('#persons-table').hide();
                    $('#error').text(`Error: ${err.statusText}`);
                }
            });
        });

        // Hire Person
        $('#hirePerson').click(function(e) {
            e.preventDefault();
            $.ajax({
                url: `http://localhost:${port}/persons/${$('#id').val()}/hire`,
                method: 'PATCH',
                success: function() {
                    $('#error').empty();
                    loadPersons();
                },
                error: function(err) {
                    $('#persons-table').hide();
                    $('#error').text(`Error: ${err.statusText}`);
                }
            });
        });

        // Vacate Person
        $('#vacatePerson').click(function(e) {
            e.preventDefault();
            $.ajax({
                url: `http://localhost:${port}/persons/${$('#id').val()}/vacate`,
                method: 'PATCH',
                success: function() {
                    $('#error').empty();
                    loadPersons();
                },
                error: function(err) {
                    $('#persons-table').hide();
                    $('#error').text(`Error: ${err.statusText}`);
                }
            });
        });

        // Count Persons
        $('#countPersons').click(function(e) {
            e.preventDefault();
            $.ajax({
                url: `http://localhost:${port}/persons/countAll`,
                method: 'GET',
                dataType: dataType,
                success: function(count) {
                    $('#error').empty();
                    if(dataType === 'xml') {
                        count = $(count).find('Integer').text();
                    }
                    alert(`Total persons: ${count}`);
                },
                error: function(err) {
                    $('#persons-table').hide();
                    $('#error').text(`Error: ${err.statusText}`);
                }
            });
        });

        // Reload
        $('#reload').click(function(e) {
            e.preventDefault();
            $('#error').empty();
            $('#persons-table').show();
            loadPersons();
        });
    });
</script>




</body>
</html>
